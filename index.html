<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FilmB√∂ng√©sz≈ë ‚Äì RPMShare+WisePlayer</title>
  <style>
    body { margin: 0; background: #000; color: #fff; font-family: Arial, sans-serif; }
    header { background: #1c1c1c; padding: 20px; text-align: center; position: relative; }
    h1 { margin: 0; color: cyan; font-size: 28px; }
    #clock { position: absolute; top: 10px; right: 20px; font-size: 16px; color: cyan; }
    #movies { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; padding: 15px; }
    .movie { background: #222; border: 6px solid limegreen; border-radius: 12px; overflow: hidden; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; }
    .movie:hover { transform: scale(1.05); box-shadow: 0 0 32px limegreen; }
    .movie img { width: 100%; height: 240px; object-fit: cover; border-radius: 8px 8px 0 0; }
    .movie-title { padding: 10px; text-align: center; font-size: 18px; color: cyan; }
    .movie-title small { display: block; color: orange; font-size: 12px; margin-top: 4px; }
    #preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 9999; }
    .loader { border: 8px solid #333; border-top: 8px solid cyan; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    #playerModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: none; align-items: center; justify-content: center; flex-direction: column; z-index: 99999; }
    #playerModal.show { display: flex; }

    #playerIframe, #hlsPlayer { width: 96vw; max-width: 900px; height: 60vw; max-height: 85vh; min-height: 210px; border: none; background: #000; border-radius: 12px; }
    #playerIframe { display: none; }
    #hlsPlayer { display: none; }

    #movieDesc { margin: 15px auto 0 auto; padding: 10px; max-width: 900px; text-align: center; color: #ccc; }
    #closeBtn { background: darkred; color: white; border: none; padding: 6px 32px; cursor: pointer; border-radius: 6px; font-size: 2rem; position: fixed; top: 12px; right: 8vw; z-index: 10001; }

    @media (max-width: 650px) {
      #playerIframe, #hlsPlayer { max-width: 98vw; height: 50vw; min-height: 150px; }
      #closeBtn { right: 4vw; padding: 3px 14px; font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>FilmB√∂ng√©sz≈ë üé¨</h1>
    <div id="clock">00:00:00</div>
  </header>

  <div id="movies"></div>
  <div id="preloader"><div class="loader"></div></div>

  <div id="playerModal">
    <div id="closeBtn" onclick="closeModal()">√ó</div>
    <iframe id="playerIframe" allowfullscreen></iframe>
    <video id="hlsPlayer" controls autoplay></video>
    <div id="movieDesc"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const proxy = "https://corsproxy.io/?url=";
    const baseUrl = "https://hdmozi.hu/genre/premier/page/";
    let currentPage = 1;
    let hls;

    function updateClock() {
      const now = new Date();
      const h = String(now.getHours()).padStart(2, '0');
      const m = String(now.getMinutes()).padStart(2, '0');
      const s = String(now.getSeconds()).padStart(2, '0');
      document.getElementById("clock").textContent = `${h}:${m}:${s}`;
    }

    async function fetchMovies(page = 1) {
      document.getElementById("preloader").style.display = "flex";
      try {
        const res = await fetch(proxy + encodeURIComponent(baseUrl + page + "/"));
        const html = await res.text();
        const doc = new DOMParser().parseFromString(html, "text/html");
        const items = doc.querySelectorAll("article.item.movies");

        items.forEach(item => {
          const link = item.querySelector("a")?.href;
          const image = item.querySelector("img")?.src;
          const title = item.querySelector("h3 a")?.textContent.trim();
          const date = item.querySelector(".data span")?.textContent.trim();

          if (link && title && image) {
            const div = document.createElement("div");
            div.className = "movie";
            div.innerHTML = `<img src="${image}" alt="${title}"><div class="movie-title">${title}<small>${date || ""}</small></div>`;
            div.onclick = () => loadPlayer(link, title);
            document.getElementById("movies").appendChild(div);
          }
        });
      } catch (err) {
        console.error("Hiba:", err);
      }
      document.getElementById("preloader").style.display = "none";
    }

    async function loadPlayer(url, title) {
      document.getElementById("preloader").style.display = "flex";
      try {
        const html = await fetch(proxy + encodeURIComponent(url)).then(r => r.text());
        const doc = new DOMParser().parseFromString(html, "text/html");
        const desc = doc.querySelector('meta[name="description"]')?.content || "Nincs le√≠r√°s.";

        // Keress RPMShare linket
        const allLinks = [...doc.querySelectorAll('iframe, a[data-slink], button[data-slink]')];
        let rpmLink = allLinks.map(el => el.src || el.href || el.getAttribute("data-slink")).find(l => l && l.includes("rpmshare.com"));

        if (rpmLink) {
          if (!rpmLink.startsWith("http")) rpmLink = "https:" + rpmLink;
          if (rpmLink.endsWith(".m3u8")) {
            playHLS(rpmLink);
          } else {
            // embed wiseplayer iframe
            showIframe(addAutoplay(rpmLink));
          }
        } else {
          alert("Nem tal√°lhat√≥ rpmshare link.");
          closeModal();
        }

        document.getElementById("movieDesc").innerText = title + " ‚Äì " + desc;
        document.getElementById("playerModal").classList.add("show");
      } catch (err) {
        alert("Hiba t√∂rt√©nt a lej√°tsz√≥ bet√∂lt√©sekor!");
        console.error(err);
      }
      document.getElementById("preloader").style.display = "none";
    }

    function addAutoplay(url) {
      return url.includes("?") ? url + "&autoplay=1" : url + "?autoplay=1";
    }

    function showIframe(src) {
      const iframe = document.getElementById("playerIframe");
      const video = document.getElementById("hlsPlayer");
      if (hls) hls.destroy();
      iframe.src = src;
      iframe.style.display = "block";
      video.style.display = "none";
      video.src = "";
    }

    function playHLS(url) {
      const video = document.getElementById("hlsPlayer");
      const iframe = document.getElementById("playerIframe");
      iframe.src = "";
      iframe.style.display = "none";

      video.style.display = "block";
      if (hls) hls.destroy();
      if (Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(proxy + encodeURIComponent(url));
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
      } else {
        video.src = proxy + encodeURIComponent(url);
        video.addEventListener("loadedmetadata", () => video.play());
      }
    }

    function closeModal() {
      document.getElementById("playerModal").classList.remove("show");
      document.getElementById("playerIframe").src = "";
      const video = document.getElementById("hlsPlayer");
      if (hls) hls.destroy();
      video.pause(); video.src = ""; video.style.display = "none";
    }

    updateClock();
    setInterval(updateClock, 1000);
    fetchMovies(currentPage);
  </script>
</body>
</html>
